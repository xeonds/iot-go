每个设备都有一套配网方式和驱动，面向开发者提供统一的IoT初始化API，开发者基于具体硬件API编写事件注册和回调函数即可。

## 设备行为

设备通过配网手段获取wifi ssid/pass，以及网关信息(ip模式或广播模式，前者对应公网/内网网关，后者仅对应内网网关)后存储在eeprom中，之后自动联网，如果联网失败则重新进入配网流程。

(仅针对广播模式){设备入网后持续自动发现网关并连接到第一个发现的网关，并存储ip:addr到eeprom以供下次快速连接。下次快速连接如果失败多次则删除信息重新进入持续自动发现网关的流程。}如果是ip模式则直接连接ip，连接失败则直接重启进入配网模式。

发现网关后，设备通过网关http api注册接口对自身id进行注册，注册完成后再通过websocket连接到设备网关，进入双工通信状态。

进入双工状态时，设备和服务器同步状态。之后在执行任意动作时，设备都和网关同步状态。

设备断开连接时，网关处更新设备状态为离线。

## 设计

不同的mcu对应一种或者几种控制器，根据性能和能力进行差分

### 接口

mmcx 插头